FROM node:22-alpine

# Install pnpm
RUN npm install -g pnpm@10.4.1

# Set working directory
WORKDIR /app

COPY . .

# Make scripts executable
RUN chmod +x scripts/prepare-docker.js scripts/approve-builds.js

# Create .husky directory if it doesn't exist
RUN mkdir -p .husky

# Set environment variables for pnpm
ENV PNPM_AUTOAPPROVESCRIPTS=true
ENV npm_config_prepare_script="prepare-docker"

# Install dependencies
RUN pnpm install --no-frozen-lockfile

# Expose ports
EXPOSE 3000 5000 9099 8080 4400 4500 9199

# Set environment variables
ENV NODE_ENV=development

# Start the application in development mode
CMD ["pnpm", "dev"]
